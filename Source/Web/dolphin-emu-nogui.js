// Fake Emscripten Runtime for Dolphin Web PoC
// This file simulates the presence of the compiled WASM module to demonstrate the frontend integration.
// In a real build, this file would be generated by Emscripten.

(function() {
    var Module = window.Module || {};

    // Minimal FS implementation to satisfy main.js
    var VFS = {};

    var FS = {
        writeFile: function(path, data) {
            console.log("[FakeFS] writeFile:", path, data.length, "bytes");
            VFS[path] = data;
        },
        readFile: function(path) {
            console.log("[FakeFS] readFile:", path);
            if (!VFS[path]) throw new Error("File not found: " + path);
            return VFS[path];
        },
        // Add other FS methods if needed
        createDataFile: function(parent, name, data, canRead, canWrite, canOwn) {
            this.writeFile((parent === '/' ? '' : parent) + '/' + name, data);
        }
    };

    Module.FS = FS;
    window.FS = FS; // Expose globally as expected by main.js check

    // Minimal callMain implementation
    Module.callMain = function(args) {
        console.log("[FakeModule] callMain:", args);
        if (Module.print) {
            Module.print("----------------------------------------------------------------");
            Module.print("Dolphin WASM Runtime Loaded (Stub)");
            Module.print("----------------------------------------------------------------");
            Module.print("This is a placeholder runtime confirming the JS pipeline works.");
            Module.print("Arguments: " + args.join(" "));
        }

        if (args.length > 0) {
            var fileName = args[args.length - 1];
            // Simple heuristic to find file argument
            if (fileName.startsWith('/')) {
                if (VFS[fileName]) {
                    Module.print("SUCCESS: File '" + fileName + "' found in VFS! Size: " + VFS[fileName].length + " bytes.");
                    Module.print("Passing file to emulator core...");
                    Module.print("(Real emulation requires compiling the C++ codebase - see README.md)");
                } else {
                    Module.print("ERROR: Could not open file '" + fileName + "' from VFS.");
                }
            }
        }
    };

    // Simulate runtime ready
    // We delay slightly to simulate async WASM loading
    setTimeout(function() {
        if (Module.onRuntimeInitialized) Module.onRuntimeInitialized();
        console.log("Runtime initialized");
    }, 500);

    window.Module = Module;
})();
